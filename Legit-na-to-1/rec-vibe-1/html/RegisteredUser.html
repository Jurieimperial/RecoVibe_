<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registered Users</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1100px;
            margin: 40px auto;
            background: #fff;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        h2 {
            margin-bottom: 24px;
            color: #333;
        }
        .filter-input {
            font-size: 1rem;
            padding: 10px 14px;
            border: 1.5px solid #1976d2;
            border-radius: 6px;
            outline: none;
            margin-bottom: 16px;
            width: 100%;
            max-width: 350px;
            transition: border-color 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
        }
        .filter-input:focus {
            border-color: #1565c0;
            box-shadow: 0 0 0 2px #1976d230;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
        }
        th, td {
            padding: 14px 12px;
            text-align: left;
        }
        th {
            background: #1976d2;
            color: #fff;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f0f4f8;
        }
        tr:hover {
            background: #e3eaf2;
        }
        .action-btn {
            background: #1976d2;
            color: #fff;
            border: none;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .action-btn:hover {
            background: #1565c0;
        }
    </style>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <!-- Add Firestore SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <!-- Add Realtime Database SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <h2>Registered Users</h2>
        <input class="filter-input" type="text" id="userSearch" placeholder="ðŸ” Search users..." style="margin-bottom: 16px; width: 100%; max-width: 350px;" />
        <table>
            <thead>
                <tr>
                    <th>User #</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Birthday</th>
                    <th>Course</th>
                    <th>Year</th>
                    <th>Section</th>
                    <th>Organization</th>
                    <!-- Add more columns for new fields -->
                    <th>Phone</th>
                    <th>Address</th>
                    <!-- etc. -->
                </tr>
            </thead>
            <tbody id="users-table-body">
                <!-- User rows will be inserted here by JS -->
            </tbody>
        </table>
    </div>
    <script>
        // No import statements needed when using compat SDK!
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAvJKueNtBRrGFxXby-VRkOewdGEkiuGnQ",
            authDomain: "first-proj-a5fff.firebaseapp.com",
            projectId: "first-proj-a5fff",
            storageBucket: "first-proj-a5fff.appspot.com",
            messagingSenderId: "902560724938",
            appId: "1:902560724938:web:2956090fc8afb5ce888133",
            measurementId: "G-0VNSBVGRK7",
            databaseURL: "https://first-proj-a5fff-default-rtdb.firebaseio.com"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const database = firebase.database();

        let allUsers = [];

        function renderUsers(users) {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = "";
            let rowNum = 1;
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${rowNum++}</td>
                    <td>${user.username || ''}</td>
                    <td>${user.email || ''}</td>
                    <td>${user.birthday || ''}</td>
                    <td>${user.course || ''}</td>
                    <td>${user.year || ''}</td>
                    <td>${user.section || ''}</td>
                    <td>${user.organization || ''}</td>
                    <td>${user.phone || ''}</td>
                    <td>${user.address || ''}</td>
                    <!-- Add more fields as needed -->
                `;
                tbody.appendChild(tr);
            });
        }

        db.collection("users").get().then((querySnapshot) => {
            allUsers = [];
            querySnapshot.forEach((doc) => {
                allUsers.push(doc.data());
            });
            renderUsers(allUsers);
        }).catch((error) => {
            console.error("Error fetching users: ", error);
        });

        document.getElementById('userSearch').addEventListener('input', function() {
            const search = this.value.toLowerCase();
            const filtered = allUsers.filter(user =>
                (user.username && user.username.toLowerCase().includes(search)) ||
                (user.email && user.email.toLowerCase().includes(search))
            );
            renderUsers(filtered);
        });

        // Store in Realtime Database under "registereduser"
        async function storeUserInDatabase(user) {
            try {
                await dbSet(dbRef(database, "registereduser/" + user.uid), {
                    name: user.name,
                    username: user.username,
                    email: user.email
                });
                console.log("User registered successfully:", user);
            } catch (error) {
                console.error("Error registering user:", error);
            }
        }

    
    </script>
</body>
</html>